---

- name: Include distro specific variables
  include_vars: "{{ loop_docker_vars }}"
  with_first_found:
    - "{{ ansible_distribution | lower }}-{{ ansible_distribution_version | lower }}.yml"
    - "{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_os_family | lower }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_distribution_release | lower }}.yml"
    - "{{ ansible_distribution | lower }}.yml"
    - "{{ ansible_os_family | lower }}.yml"
  loop_control:
    loop_var: loop_docker_vars

- name: Run distro specific base tasks
  include_tasks: "{{ loop_docker_tasks }}"
  with_first_found:
    - "{{ ansible_distribution | lower }}-{{ ansible_distribution_version | lower }}.yml"
    - "{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_os_family | lower }}-{{ ansible_distribution_major_version | lower }}.yml"
    - "{{ ansible_distribution_release | lower }}.yml"
    - "{{ ansible_distribution | lower }}.yml"
    - "{{ ansible_os_family | lower }}.yml"
  loop_control:
    loop_var: loop_docker_tasks

- name: Checkout git repository
  become: yes
  become_user: "{{ user }}"
  git:
    repo: https://github.com/AFLplusplus/AFLplusplus.git
    dest: {{ download_location }}
    version: {{ version }}

- name: Build Project
  become: yes
  become_user: "{{ user }}"
  make:
    chdir: {{ download_location }}
    target: distrib

- name: Install Project
  make:
    chdir: {{ download_location }}
    target: install
  become: yes
